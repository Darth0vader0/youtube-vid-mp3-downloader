<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search - Spotify Clone</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/9699ff2ebc.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/searchOnSpotify.css">
</head>

<body>
    <div class="music-player-page" style="display: none;">
        <div class="standalone-player">
            <div class="album-display">
                <div class="album-art">
                    <img src="https://i.scdn.co/image/ab67616d00001e02ff9ca10b55ce82ae553c8228" alt="Album Art">
                </div>
                <div class="album-info">
                    <h2 class="track-name">Blinding Lights</h2>
                    <p class="artist-name">The Weeknd</p>
                    <p class="album-name">After Hours</p>
                </div>
            </div>

            <div class="player-section">
                <div class="player-controls">
                    <div class="control-buttons">

                        <button class="control-button shuffle">
                            <svg width="16" height="16" viewBox="0 0 16 16">
                                <path
                                    d="M13.151.922a.75.75 0 10-1.06 1.06L13.109 3H11.16a3.75 3.75 0 00-2.873 1.34l-6.173 7.356A2.25 2.25 0 01.39 12.5H0V14h.391a3.75 3.75 0 002.873-1.34l6.173-7.356a2.25 2.25 0 011.724-.804h1.947l-1.017 1.018a.75.75 0 001.06 1.06L15.98 3.75 13.15.922zM.391 3.5H0V2h.391c1.109 0 2.16.49 2.873 1.34L4.89 5.277l-.979 1.167-1.796-2.14A2.25 2.25 0 00.39 3.5z"
                                    fill="currentColor" />
                                <path
                                    d="M7.5 10.723l.98-1.167.957 1.14a2.25 2.25 0 001.724.804h1.947l-1.017-1.018a.75.75 0 111.06-1.06l2.829 2.828-2.829 2.828a.75.75 0 11-1.06-1.06L13.109 13H11.16a3.75 3.75 0 01-2.873-1.34l-.787-.938z"
                                    fill="currentColor" />
                            </svg>
                        </button>
                        <button class="control-button previous">
                            <svg width="16" height="16" viewBox="0 0 16 16">
                                <path d="M13 2.5L5 7.119V3H3v10h2V8.881l8 4.619z" fill="currentColor" />
                            </svg>
                        </button>
                        <button class="control-button play-pause">
                            <svg width="16" height="16" viewBox="0 0 16 16">
                                <path d="M3 2l10 6-10 6z" fill="currentColor" />
                            </svg>
                        </button>
                        <button class="control-button next">
                            <svg width="16" height="16" viewBox="0 0 16 16">
                                <path d="M11 3v4.119L3 2.5v11l8-4.619V13h2V3z" fill="currentColor" />
                            </svg>
                        </button>
                        <button class="control-button repeat">
                            <svg width="16" height="16" viewBox="0 0 16 16">
                                <path
                                    d="M0 4.75A3.75 3.75 0 013.75 1h8.5A3.75 3.75 0 0116 4.75v5a3.75 3.75 0 01-3.75 3.75H9.81l1.018 1.018a.75.75 0 11-1.06 1.06L6.939 12.75l2.829-2.828a.75.75 0 111.06 1.06L9.811 12h2.439a2.25 2.25 0 002.25-2.25v-5a2.25 2.25 0 00-2.25-2.25h-8.5A2.25 2.25 0 001.5 4.75v5A2.25 2.25 0 003.75 12H5v1.5H3.75A3.75 3.75 0 010 9.75v-5z"
                                    fill="currentColor" />
                            </svg>
                        </button>
                    </div>
                    <div class="progressBar">
                        <span>2:15</span>
                        <div class="progress-slider"></div>
                        <span>3:35</span>
                    </div>
                </div>

                <div class="additional-controls">
                    <button class="control-button lyrics">
                        <svg width="16" height="16" viewBox="0 0 16 16">
                            <path
                                d="M13.426 2.574a2.831 2.831 0 00-4.797 1.55l3.247 3.247a2.831 2.831 0 001.55-4.797zM10.5 8.118l-2.619-2.62A63303.13 63303.13 0 004.74 9.075L2.065 12.12a1.287 1.287 0 001.816 1.816l3.06-2.688 3.56-3.129zM7.12 4.094a4.331 4.331 0 114.786 4.786l-3.974 3.474-3.06 2.689a2.787 2.787 0 01-3.933-3.933l2.676-3.045 3.505-3.97z"
                                fill="currentColor" />
                        </svg>
                    </button>
                    <button class="control-button queue">
                        <svg width="16" height="16" viewBox="0 0 16 16">
                            <path
                                d="M15 15H1v-1.5h14V15zm0-4.5H1V9h14v1.5zm-14-7A2.5 2.5 0 013.5 1h9a2.5 2.5 0 010 5h-9A2.5 2.5 0 011 3.5zm2.5-1a1 1 0 000 2h9a1 1 0 100-2h-9z"
                                fill="currentColor" />
                        </svg>
                    </button>
                    <button class="control-button devices">
                        <svg width="16" height="16" viewBox="0 0 16 16">
                            <path
                                d="M6 2.75C6 1.784 6.784 1 7.75 1h6.5c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0114.25 15h-6.5A1.75 1.75 0 016 13.25V2.75zm1.75-.25a.25.25 0 00-.25.25v10.5c0 .138.112.25.25.25h6.5a.25.25 0 00.25-.25V2.75a.25.25 0 00-.25-.25h-6.5zm-6 0a.25.25 0 00-.25.25v6.5c0 .138.112.25.25.25H4V11H1.75A1.75 1.75 0 010 9.25v-6.5C0 1.784.784 1 1.75 1H4v1.5H1.75zM4 15H2v-1.5h2V15z"
                                fill="currentColor" />
                        </svg>
                    </button>
                    <div class="volume-controls">
                        <button class="control-button volume">
                            <svg width="16" height="16" viewBox="0 0 16 16">
                                <path
                                    d="M12.945 1.379l-.652.763c1.577 1.462 2.57 3.544 2.57 5.858s-.994 4.396-2.57 5.858l.651.763a8.966 8.966 0 00.001-13.242zm-2.272 2.66l-.651.763a4.484 4.484 0 01-.001 6.397l.651.763c1.04-1 1.691-2.404 1.691-3.961s-.65-2.962-1.69-3.962zM0 5v6h2.804L8 13V3L2.804 5H0zm7-1.268v8.536L3.072 10H1V6h2.072L7 3.732z"
                                    fill="currentColor" />
                            </svg>
                        </button>
                        <div class="volume-slider"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="overlay"></div>
    <div class="container-fluid">
        <div class="row">

            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 sidebar">
                <div class="d-flex flex-column p-3">
                    <img src="photos/melodify__2_-removebg-preview.png" height="80px" style="margin-left: 5px;" alt="">
                    
                    <ul class="nav nav-pills flex-column mb-auto">
                        <li class="nav-item">
                            <a href="/" class="nav-link">
                                <i class="bi bi-house-door me-2"></i>Home
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/searchOnYoutube" class="nav-link ">
                                <i class="fa-brands fa-square-youtube me-2"></i>Youtube
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="library.html" class="nav-link">
                                <i class="bi bi-collection me-2"></i>Library
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/searchOnSpotify" class="nav-link active">
                                <i class="fa-brands fa-spotify me-2"></i>Spotify
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 main-content">
                <div class="content-header p-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="nav-buttons">
                            <button class="btn btn-dark rounded-circle me-2">
                                <i class="bi bi-chevron-left"></i>
                            </button>
                            <button class="btn btn-dark rounded-circle">
                                <i class="bi bi-chevron-right"></i>
                            </button>
                        </div>

                    </div>
                </div>

                <!-- Search Section -->
                <div class="p-3">
                    <div class="search-container mb-4">
                        <div class="input-group">
                            <span class="input-group-text search-icon">
                                <i class="bi bi-search"></i>
                            </span>
                            <input type="text" class="form-control search-input" placeholder="Search for spotify songs">
                            <button id="search-btn">search</button>
                        </div>
                    </div>

                    <div id="searchResults" class="mb-4 d-none">
                        <h3 class="text-white mb-3">Search Results</h3>
                        <div class="row g-3 song-container" id="resultsContainer" >
                            <!-- Results will be populated here -->
                        </div>
                    </div>

                    <div id="browseAll">
                        <h3 class="text-white mb-3">Browse All</h3>
                        <div class="row g-3">
                            <div class="col-sm-6 col-md-4 col-lg-3">
                                <div class="category-card bg-gradient-1">
                                    <h4>Pop</h4>
                                </div>
                            </div>
                            <div class="col-sm-6 col-md-4 col-lg-3">
                                <div class="category-card bg-gradient-2">
                                    <h4>Hip-Hop</h4>
                                </div>
                            </div>
                            <div class="col-sm-6 col-md-4 col-lg-3">
                                <div class="category-card bg-gradient-3">
                                    <h4>Rock</h4>
                                </div>
                            </div>
                            <div class="col-sm-6 col-md-4 col-lg-3">
                                <div class="category-card bg-gradient-4">
                                    <h4>Jazz</h4>
                                </div>
                            </div>
                            <div class="col-sm-6 col-md-4 col-lg-3">
                                <div class="category-card bg-gradient-5">
                                    <h4>Classical</h4>
                                </div>
                            </div>
                            <div class="col-sm-6 col-md-4 col-lg-3">
                                <div class="category-card bg-gradient-6">
                                    <h4>Electronic</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Player (same as index.html) -->
        <div class="player fixed-bottom" id="footer">
            <div class="container-fluid">
                <div class="row align-items-center">
                    <div class="col-md-3" style="cursor: pointer;" id="playlistToggle">
                        <div class="d-flex align-items-center">
                            <img src="https://via.placeholder.com/300x400" alt="Now Playing"
                                class="me-3 w-25 rounded-1">
                            <div>
                                <h6 class="text-white mb-0">Song Title</h6>
                                <small class="">Artist</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="player-controls text-center">
                            <button class="btn btn-link text-white mx-2"><i class="bi bi-shuffle"></i></button>
                            <button class="btn btn-link text-white mx-2"><i class="bi bi-skip-start-fill"></i></button>
                            <button class="btn btn-link text-white mx-2"><i
                                    class="bi bi-play-circle-fill fs-2"></i></button>
                            <button class="btn btn-link text-white mx-2"><i class="bi bi-skip-end-fill"></i></button>
                            <button class="btn btn-link text-white mx-2"><i class="bi bi-repeat"></i></button>
                        </div>
                        <div class="progress mt-2">
                            <div class="progress-bar" role="progressbar" style="width: 45%"></div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="volume-controls text-end">
                            <button class="btn btn-link text-white"><i class="bi bi-volume-up"></i></button>
                            <input type="range" class="form-range d-inline-block w-50">
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>

        const fixedBottom = document.querySelector('.fixed-bottom');
        const playlistToggle = document.querySelector('#playlistToggle');
        const miniplayer = document.querySelector('.music-player-page');
        const overlay = document.querySelector('.overlay');

        playlistToggle.addEventListener('click', () => {
            miniplayer.style.display ='block';
            fixedBottom.style.opacity = 0;
            const isActive = miniplayer.classList.toggle('active');
            overlay.classList.toggle('active', isActive);
        });

        // Optional: Close mini player by clicking the overlay
        overlay.addEventListener('click', () => {
            fixedBottom.style.opacity = 1;
            miniplayer.classList.remove('active');
            overlay.classList.remove('active');
            miniplayer.style.display ='none';

        });
        const searchInput = document.querySelector('.search-input');
        const searchResults = document.getElementById('searchResults');
        const resultsContainer = document.getElementById('resultsContainer');
        const browseAll = document.getElementById('browseAll');
        const searchBtn = document.getElementById('search-btn');

        searchInput.addEventListener("input", () => {
            if (searchInput.value.length === 0) {

                searchResults.classList.add('d-none');
                browseAll.classList.remove('d-none');
            }

        })
        searchBtn.addEventListener('click', async () => {
            const searchTerm = searchInput.value.toLowerCase();

            try {
                const response = await fetch(`/searchSpotify?query=${encodeURIComponent(searchTerm)}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer YOUR_API_TOKEN', // Replace with your API key/token
                    },
                });

                if (!response.ok) {
                    throw new Error(`Error: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();

                // Handle the fetched song data
                console.log(data);
                searchResults.classList.remove('d-none');
                browseAll.classList.add('d-none');
                displaySongs(data.results); // Adjust to match your API's response structure
            } catch (error) {
                console.error('Error fetching songs:', error);
            }



        })
        async function downloadSpotifySong(button) {

            const name = button.dataset.trackname;
            const artist = button.dataset.trackartist;

          const downloadRes = await fetch('/downloadSpotifyTrack', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name: name, artist: artist }),
          });

          const downloadData = await downloadRes.json();
          console.log(downloadData.message);
    
    }

        function displaySongs(songs) {
            const songContainer = document.querySelector('.song-container');
            songContainer.innerHTML = ''; // Clear previous results

            songs.forEach((song) => {
                const songCard =  `
         <div class="track-card">
            <div class="track-cover">
                <img src="${song.thumbnail}"  
                     alt="${song.name}"  
                     class="track-thumbnail">
                <div class="track-play-icon"></div>
            </div>
            <div class="track-info">
                <div class="track-details">
                    <div class="track-name">${song.name}</div>
                    <div class="track-artist">${song.artist}</div>
                </div>
                <button data-trackId="${song.id}" data-trackArtist="${song.artist}" data-trackName="${song.name}" onclick="downloadSpotifySong(this)"  style="cursor: pointer; z-index: 3;"
                   class="track-link">
                    <i class="fa-solid fa-download"></i>
                </button>
            </div>
        </div>
        `;
       
                songContainer.innerHTML += songCard;
            });
        }

        let footer = document.getElementById('footer');
        let timeout;

        function hideFooter() {
            footer.classList.add('hidden');
        }

        function showFooter() {
            footer.classList.remove('hidden');
            resetTimeout();  // Reset timeout when footer is shown
        }

        function resetTimeout() {
            clearTimeout(timeout);
            timeout = setTimeout(hideFooter, 3000); // Hide after 3 seconds of inactivity
        }

        // Show footer when mouse is over the window or any interaction occurs
        window.addEventListener('mousemove', showFooter);
        window.addEventListener('keydown', showFooter);

        // Hide footer after a timeout when idle
        resetTimeout();
    </script>
</body>

</html>